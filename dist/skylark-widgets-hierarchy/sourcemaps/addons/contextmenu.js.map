{"version":3,"sources":["addons/contextmenu.js"],"names":["define","exports","module","__isValidToReturn","obj","Array","isArray","attr","__isEmptyObject","langx","browser","eventer","noder","geom","$","menu","jstree","plugins","contextmenu","defaults","select_node","show_at_node","items","o","cb","create","separator_before","separator_after","_disabled","label","action","data","inst","reference","get_node","create_node","new_node","edit","ex","setTimeout","rename","remove","icon","is_selected","delete_node","get_selected","ccp","submenu","cut","get_top_selected","copy","paste","can_paste","options","parent","this","bind","call","ey","last_ts","cto","element","on","proxy","get_container_ul","addClass","e","target","tagName","toLowerCase","preventDefault","ctrlKey","Date","clearTimeout","is_loading","currentTarget","show_contextmenu","pageX","pageY","_data","visible","hide","originalEvent","changedTouches","clientX","clientY","trigger","Math","abs","document","removeClass","teardown","x","y","id","root","s","settings","a","children","i","undefined","offset","left","top","core","li_height","activate_node","isFunction","_show_contextmenu","isPlainObject","one","cls","get_theme","popup","node"],"mappings":"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","file":"../../addons/contextmenu.js","sourcesContent":["define([], function () {\n    'use strict';\n    var exports = {};\n    var module = { exports: {} };\n    define([\n        'skylark-langx/langx',\n        'skylark-domx-browser',\n        'skylark-domx-eventer',\n        'skylark-domx-noder',\n        'skylark-domx-geom',\n        'skylark-domx-query',\n        './menu',\n        'Hierarchy'\n    ], function (langx, browser, eventer, noder, geom, $, menu, jstree) {\n        if ($.jstree.plugins.contextmenu) {\n            return;\n        }\n        $.jstree.defaults.contextmenu = {\n            select_node: true,\n            show_at_node: true,\n            items: function (o, cb) {\n                return {\n                    'create': {\n                        'separator_before': false,\n                        'separator_after': true,\n                        '_disabled': false,\n                        'label': 'Create',\n                        'action': function (data) {\n                            var inst = $.jstree.reference(data.reference), obj = inst.get_node(data.reference);\n                            inst.create_node(obj, {}, 'last', function (new_node) {\n                                try {\n                                    inst.edit(new_node);\n                                } catch (ex) {\n                                    setTimeout(function () {\n                                        inst.edit(new_node);\n                                    }, 0);\n                                }\n                            });\n                        }\n                    },\n                    'rename': {\n                        'separator_before': false,\n                        'separator_after': false,\n                        '_disabled': false,\n                        'label': 'Rename',\n                        'action': function (data) {\n                            var inst = $.jstree.reference(data.reference), obj = inst.get_node(data.reference);\n                            inst.edit(obj);\n                        }\n                    },\n                    'remove': {\n                        'separator_before': false,\n                        'icon': false,\n                        'separator_after': false,\n                        '_disabled': false,\n                        'label': 'Delete',\n                        'action': function (data) {\n                            var inst = $.jstree.reference(data.reference), obj = inst.get_node(data.reference);\n                            if (inst.is_selected(obj)) {\n                                inst.delete_node(inst.get_selected());\n                            } else {\n                                inst.delete_node(obj);\n                            }\n                        }\n                    },\n                    'ccp': {\n                        'separator_before': true,\n                        'icon': false,\n                        'separator_after': false,\n                        'label': 'Edit',\n                        'action': false,\n                        'submenu': {\n                            'cut': {\n                                'separator_before': false,\n                                'separator_after': false,\n                                'label': 'Cut',\n                                'action': function (data) {\n                                    var inst = $.jstree.reference(data.reference), obj = inst.get_node(data.reference);\n                                    if (inst.is_selected(obj)) {\n                                        inst.cut(inst.get_top_selected());\n                                    } else {\n                                        inst.cut(obj);\n                                    }\n                                }\n                            },\n                            'copy': {\n                                'separator_before': false,\n                                'icon': false,\n                                'separator_after': false,\n                                'label': 'Copy',\n                                'action': function (data) {\n                                    var inst = $.jstree.reference(data.reference), obj = inst.get_node(data.reference);\n                                    if (inst.is_selected(obj)) {\n                                        inst.copy(inst.get_top_selected());\n                                    } else {\n                                        inst.copy(obj);\n                                    }\n                                }\n                            },\n                            'paste': {\n                                'separator_before': false,\n                                'icon': false,\n                                '_disabled': function (data) {\n                                    return !$.jstree.reference(data.reference).can_paste();\n                                },\n                                'separator_after': false,\n                                'label': 'Paste',\n                                'action': function (data) {\n                                    var inst = $.jstree.reference(data.reference), obj = inst.get_node(data.reference);\n                                    inst.paste(obj);\n                                }\n                            }\n                        }\n                    }\n                };\n            }\n        };\n        $.jstree.plugins.contextmenu = function (options, parent) {\n            this.bind = function () {\n                parent.bind.call(this);\n                var last_ts = 0, cto = null, ex, ey;\n                this.element.on('init.jstree loading.jstree ready.jstree', $.proxy(function () {\n                    this.get_container_ul().addClass('jstree-contextmenu');\n                }, this)).on('contextmenu.jstree', '.jstree-anchor', $.proxy(function (e, data) {\n                    if (e.target.tagName.toLowerCase() === 'input') {\n                        return;\n                    }\n                    e.preventDefault();\n                    last_ts = e.ctrlKey ? +new Date() : 0;\n                    if (data || cto) {\n                        last_ts = +new Date() + 10000;\n                    }\n                    if (cto) {\n                        clearTimeout(cto);\n                    }\n                    if (!this.is_loading(e.currentTarget)) {\n                        this.show_contextmenu(e.currentTarget, e.pageX, e.pageY, e);\n                    }\n                }, this)).on('click.jstree', '.jstree-anchor', $.proxy(function (e) {\n                    if (this._data.contextmenu.visible && (!last_ts || +new Date() - last_ts > 250)) {\n                        menu.hide();\n                    }\n                    last_ts = 0;\n                }, this)).on('touchstart.jstree', '.jstree-anchor', function (e) {\n                    if (!e.originalEvent || !e.originalEvent.changedTouches || !e.originalEvent.changedTouches[0]) {\n                        return;\n                    }\n                    ex = e.originalEvent.changedTouches[0].clientX;\n                    ey = e.originalEvent.changedTouches[0].clientY;\n                    cto = setTimeout(function () {\n                        $(e.currentTarget).trigger('contextmenu', true);\n                    }, 750);\n                }).on('touchmove.vakata.jstree', function (e) {\n                    if (cto && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0] && (Math.abs(ex - e.originalEvent.changedTouches[0].clientX) > 10 || Math.abs(ey - e.originalEvent.changedTouches[0].clientY) > 10)) {\n                        clearTimeout(cto);\n                        menu.hide();\n                    }\n                }).on('touchend.vakata.jstree', function (e) {\n                    if (cto) {\n                        clearTimeout(cto);\n                    }\n                });\n                $(document).on('context_hide.sbswt.popup', $.proxy(function (e, data) {\n                    this._data.contextmenu.visible = false;\n                    $(data.reference).removeClass('jstree-context');\n                }, this));\n            };\n            this.teardown = function () {\n                if (this._data.contextmenu.visible) {\n                    menu.hide();\n                }\n                parent.teardown.call(this);\n            };\n            this.show_contextmenu = function (obj, x, y, e) {\n                obj = this.get_node(obj);\n                if (!obj || obj.id === $.jstree.root) {\n                    return false;\n                }\n                var s = this.settings.contextmenu, d = this.get_node(obj, true), a = d.children('.jstree-anchor'), o = false, i = false;\n                if (s.show_at_node || x === undefined || y === undefined) {\n                    o = a.offset();\n                    x = o.left;\n                    y = o.top + this._data.core.li_height;\n                }\n                if (this.settings.contextmenu.select_node && !this.is_selected(obj)) {\n                    this.activate_node(obj, e);\n                }\n                i = s.items;\n                if ($.isFunction(i)) {\n                    i = i.call(this, obj, $.proxy(function (i) {\n                        this._show_contextmenu(obj, x, y, i);\n                    }, this));\n                }\n                if ($.isPlainObject(i)) {\n                    this._show_contextmenu(obj, x, y, i);\n                }\n            };\n            this._show_contextmenu = function (obj, x, y, i) {\n                var d = this.get_node(obj, true), a = d.children('.jstree-anchor');\n                $(document).one('context_show.sbswt.popup', $.proxy(function (e, data) {\n                    var cls = 'jstree-contextmenu jstree-' + this.get_theme() + '-contextmenu';\n                    $(data.element).addClass(cls);\n                    a.addClass('jstree-context');\n                }, this));\n                this._data.contextmenu.visible = true;\n                menu.popup(a, {\n                    'x': x,\n                    'y': y\n                }, i);\n                this.trigger('show_contextmenu', {\n                    'node': obj,\n                    'x': x,\n                    'y': y\n                });\n            };\n        };\n        return $;\n    });\n    function __isEmptyObject(obj) {\n        var attr;\n        for (attr in obj)\n            return !1;\n        return !0;\n    }\n    function __isValidToReturn(obj) {\n        return typeof obj != 'object' || Array.isArray(obj) || !__isEmptyObject(obj);\n    }\n    if (__isValidToReturn(module.exports))\n        return module.exports;\n    else if (__isValidToReturn(exports))\n        return exports;\n});"]}